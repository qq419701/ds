{% extends "layouts/base.html" %}
{% block title %}{{ 'ç¼–è¾‘ç”¨æˆ·' if user else 'æ–°å»ºç”¨æˆ·' }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-title">{{ 'ç¼–è¾‘ç”¨æˆ·' if user else 'ğŸ‘¥ æ–°å»ºç”¨æˆ·' }}</div>
    <form method="POST">
        <div class="form-row">
            <div class="form-group">
                <label>ç”¨æˆ·å *</label>
                {% if user %}
                <input type="text" class="form-control" value="{{ user.username }}" disabled>
                {% else %}
                <input type="text" name="username" class="form-control" required>
                {% endif %}
            </div>
            <div class="form-group">
                <label>{{ 'æ–°å¯†ç ï¼ˆç•™ç©ºä¸ä¿®æ”¹ï¼‰' if user else 'å¯†ç  *' }}</label>
                <input type="password" name="password" class="form-control" {{ '' if user else 'required' }}>
            </div>
            <div class="form-group">
                <label>å§“å</label>
                <input type="text" name="name" class="form-control" value="{{ user.name or '' if user else '' }}">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>è§’è‰²</label>
                <select name="role" class="form-control">
                    <option value="operator" {{ 'selected' if not user or user.role == 'operator' }}>æ“ä½œå‘˜</option>
                    <option value="admin" {{ 'selected' if user and user.role == 'admin' }}>ç®¡ç†å‘˜</option>
                </select>
            </div>
            <div class="form-group">
                <label>çŠ¶æ€</label>
                <select name="is_active" class="form-control">
                    <option value="1" {{ 'selected' if not user or user.is_active_flag == 1 }}>æ¿€æ´»</option>
                    <option value="0" {{ 'selected' if user and user.is_active_flag == 0 }}>ç¦ç”¨</option>
                </select>
            </div>
        </div>

        <div class="section-title">æƒé™é…ç½®</div>
        <div class="form-row">
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="hidden" name="can_view_order" value="0">
                    <input type="checkbox" name="can_view_order" value="1" {{ 'checked' if not user or user.can_view_order }}>
                    æŸ¥çœ‹è®¢å•
                </label>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="hidden" name="can_deliver" value="0">
                    <input type="checkbox" name="can_deliver" value="1" {{ 'checked' if user and user.can_deliver }}>
                    å‘è´§æƒé™
                </label>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="hidden" name="can_refund" value="0">
                    <input type="checkbox" name="can_refund" value="1" {{ 'checked' if user and user.can_refund }}>
                    é€€æ¬¾æƒé™
                </label>
            </div>
        </div>

        <div class="section-title">åº—é“ºæƒé™</div>
        <div class="form-row">
            {% for shop in shops %}
            <div class="form-group" style="flex: 0 0 auto;">
                <label class="checkbox-label">
                    <input type="checkbox" name="shop_ids" value="{{ shop.id }}"
                           {{ 'checked' if user and user_shop_ids is defined and shop.id in user_shop_ids }}>
                    {{ shop.shop_name }}
                </label>
            </div>
            {% endfor %}
            {% if not shops %}
            <div class="form-group"><em>æš‚æ— åº—é“º</em></div>
            {% endif %}
        </div>

        <div class="flex gap-2 mt-4">
            <button type="submit" class="btn btn-primary">ä¿å­˜</button>
            <a href="{{ url_for('user.user_list') }}" class="btn">å–æ¶ˆ</a>
        </div>
    </form>
</div>
{% endblock %}
