{% extends "layouts/base.html" %}
{% block title %}{{ 'ç¼–è¾‘åº—é“º' if shop else 'æ–°å»ºåº—é“º' }}{% endblock %}

{% block content %}

<div class="card mb-4" style="background: #f0f8ff; border-left: 4px solid #1890ff;">
    <div class="card-title" style="display: flex; justify-content: space-between; align-items: center;">
        <span>ğŸ“‹ æäº¤ç»™äº¬ä¸œå®˜æ–¹çš„å›ºå®šæ¥å£ä¿¡æ¯</span>
        <button type="button" class="btn btn-sm" onclick="copyAllInfo()" style="background: #52c41a; color: white;">ğŸ“‘ ä¸€ï¿½ï¿½ï¿½å¤åˆ¶å…¨éƒ¨</button>
    </div>
    
    <div class="alert alert-warning mb-3" style="background: #fff7e6; border: 1px solid #ffd591; padding: 10px; border-radius: 4px;">
        <strong>âš ï¸ é‡è¦ï¼š</strong>ä»¥ä¸‹æ˜¯å›ºå®šæ¥å£ä¿¡æ¯ï¼Œæä¾›ç»™æ‰€æœ‰å®¢æˆ·ç”³è¯·äº¬ä¸œæ¥å£æ—¶ä½¿ç”¨ã€‚
    </div>
    
    <div id="fixedApiInfo">
        <div class="info-row">
            <strong>æœåŠ¡å™¨IPç™½åå•ï¼š</strong>
            <span class="info-value">{{ request.host.split(':')[0] }}</span>
            <button class="btn-copy" onclick="copyText('{{ request.host.split(':')[0] }}')">ğŸ“‹ å¤åˆ¶</button>
        </div>
        
        <hr style="margin: 15px 0; border-top: 1px solid #d9d9d9;">
        
        <div class="section-subtitle">ğŸ® æ¸¸æˆç‚¹å¡æ¥å£é…ç½®</div>
        
        <div class="info-row">
            <strong>2.2.1 ç›´å……æ¥å•æ¥å£ï¼š</strong>
            <span class="info-value">{{ request.scheme }}://{{ request.host }}/api/game/direct</span>
            <button class="btn-copy" onclick="copyText('{{ request.scheme }}://{{ request.host }}/api/game/direct')">ğŸ“‹ å¤åˆ¶</button>
        </div>
        
        <div class="info-row">
            <strong>2.2.2 ç›´å……è®¢å•æŸ¥è¯¢ï¼š</strong>
            <span class="info-value">{{ request.scheme }}://{{ request.host }}/api/game/query</span>
            <button class="btn-copy" onclick="copyText('{{ request.scheme }}://{{ request.host }}/api/game/query')">ğŸ“‹ å¤åˆ¶</button>
        </div>
        
        <div class="info-row">
            <strong>2.3.1 å¡å¯†æ¥å•æ¥å£ï¼š</strong>
            <span class="info-value">{{ request.scheme }}://{{ request.host }}/api/game/card</span>
            <button class="btn-copy" onclick="copyText('{{ request.scheme }}://{{ request.host }}/api/game/card')">ğŸ“‹ å¤åˆ¶</button>
        </div>
        
        <div class="info-row">
            <strong>2.3.2 å¡å¯†è®¢å•æŸ¥è¯¢ï¼š</strong>
            <span class="info-value">{{ request.scheme }}://{{ request.host }}/api/game/card-query</span>
            <button class="btn-copy" onclick="copyText('{{ request.scheme }}://{{ request.host }}/api/game/card-query')">ğŸ“‹ å¤åˆ¶</button>
        </div>
        
        <hr style="margin: 15px 0; border-top: 1px solid #d9d9d9;">
        
        <div class="section-subtitle">ğŸª é€šç”¨äº¤æ˜“æ¥å£é…ç½®</div>
        
        <div class="info-row">
            <strong>å……å€¼/æå–å¡å¯†æ¥å£ï¼š</strong>
            <span class="info-value">{{ request.scheme }}://{{ request.host }}/api/general/distill</span>
            <button class="btn-copy" onclick="copyText('{{ request.scheme }}://{{ request.host }}/api/general/distill')">ğŸ“‹ å¤åˆ¶</button>
        </div>
        
        <div class="info-row">
            <strong>åæŸ¥è®¢å•æ¥å£ï¼š</strong>
            <span class="info-value">{{ request.scheme }}://{{ request.host }}/api/general/query</span>
            <button class="btn-copy" onclick="copyText('{{ request.scheme }}://{{ request.host }}/api/general/query')">ğŸ“‹ å¤åˆ¶</button>
        </div>
        
        <hr style="margin: 15px 0; border-top: 1px solid #d9d9d9;">
        
        <div class="alert alert-info mb-0" style="background: #e6f7ff; border: 1px solid #91d5ff; padding: 10px; border-radius: 4px;">
            <strong>ğŸ“ ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
            â€¢ æ‰€æœ‰å®¢æˆ·ä½¿ç”¨ç›¸åŒçš„å›ºå®šæ¥å£åœ°å€<br>
            â€¢ å®¢æˆ·ç”³è¯·ä¸‹æ¥åï¼Œäº¬ä¸œä¼šåˆ†é…ï¼š<strong>å•†å®¶ID</strong> å’Œ <strong>MD5å¯†é’¥</strong><br>
            â€¢ å®¢æˆ·æ‹¿åˆ°å¯†é’¥åï¼Œåœ¨ä¸‹æ–¹å¯¹åº”ä½ç½®å¡«å†™å³å¯<br>
            â€¢ äº¬ä¸œæ¨é€è®¢å•æ—¶ä¼šæºå¸¦åº—é“ºæ ‡è¯†ï¼ˆshop_code æˆ– shop_idï¼‰ï¼Œç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«
        </div>
    </div>
</div>

<style>
.info-row {
    display: flex;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #f0f0f0;
}
.info-row:last-child {
    border-bottom: none;
}
.info-row strong {
    min-width: 200px;
    color: #333;
    font-size: 14px;
}
.info-value {
    flex: 1;
    color: #1890ff;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    word-break: break-all;
}
.btn-copy {
    margin-left: 10px;
    padding: 4px 12px;
    background: #52c41a;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    white-space: nowrap;
}
.btn-copy:hover {
    background: #389e0d;
}
.section-subtitle {
    font-weight: bold;
    color: #1890ff;
    margin: 15px 0 10px 0;
    font-size: 16px;
}
</style>

<script>
function copyText(text) {
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
            showToast('âœ… å·²å¤åˆ¶ï¼š' + text);
        }).catch(() => {
            fallbackCopy(text);
        });
    } else {
        fallbackCopy(text);
    }
}

function fallbackCopy(text) {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    textarea.style.position = 'fixed';
    textarea.style.opacity = '0';
    document.body.appendChild(textarea);
    textarea.select();
    try {
        document.execCommand('copy');
        showToast('âœ… å·²å¤åˆ¶ï¼š' + text);
    } catch (err) {
        showToast('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
    }
    document.body.removeChild(textarea);
}

function copyAllInfo() {
    const text = `æœåŠ¡å™¨IPç™½åå•ï¼š{{ request.host.split(':')[0] }}

ğŸ® æ¸¸æˆç‚¹å¡æ¥å£é…ç½®
2.2.1 ç›´å……æ¥å•æ¥å£ï¼š{{ request.scheme }}://{{ request.host }}/api/game/direct
2.2.2 ç›´å……è®¢å•æŸ¥è¯¢ï¼š{{ request.scheme }}://{{ request.host }}/api/game/query
2.3.1 å¡å¯†æ¥å•æ¥å£ï¼š{{ request.scheme }}://{{ request.host }}/api/game/card
2.3.2 å¡å¯†è®¢å•æŸ¥è¯¢ï¼š{{ request.scheme }}://{{ request.host }}/api/game/card-query

ğŸª é€šç”¨äº¤æ˜“æ¥å£é…ç½®
å……å€¼/æå–å¡å¯†æ¥å£ï¼š{{ request.scheme }}://{{ request.host }}/api/general/distill
åæŸ¥è®¢å•æ¥å£ï¼š{{ request.scheme }}://{{ request.host }}/api/general/query`;
    
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
            showToast('âœ… å·²å¤åˆ¶å…¨éƒ¨æ¥å£ä¿¡æ¯åˆ°å‰ªè´´æ¿');
        }).catch(() => {
            fallbackCopy(text);
        });
    } else {
        fallbackCopy(text);
    }
}

function showToast(message) {
    const toast = document.createElement('div');
    toast.style.cssText = 'position:fixed;top:80px;right:20px;background:#52c41a;color:white;padding:15px 20px;border-radius:4px;z-index:9999;box-shadow:0 4px 12px rgba(0,0,0,0.15);font-size:14px;';
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => {
        toast.style.transition = 'opacity 0.3s';
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
    }, 2500);
}
</script>

<div class="card">
    <div class="card-title">{{ 'âœï¸ ç¼–è¾‘åº—é“ºé…ç½®' if shop else 'ğŸª æ–°å»ºåº—é“º' }}</div>
    
    {% if shop %}
    <div class="alert alert-info mb-3" style="background: #e6f7ff; border: 1px solid #91d5ff; padding: 10px;">
        <strong>ğŸ’¡ æç¤ºï¼š</strong>å®¢æˆ·ç”³è¯·åˆ°äº¬ä¸œå¯†é’¥åï¼Œè¯·åœ¨ä¸‹æ–¹å¯¹åº”ä½ç½®å¡«å†™
    </div>
    {% endif %}
    
    <form method="POST">
        <div class="form-row">
            <div class="form-group">
                <label>åº—é“ºåç§° *</label>
                <input type="text" name="shop_name" class="form-control" value="{{ shop.shop_name if shop else '' }}" required>
            </div>
            {% if not shop %}
            <div class="form-group">
                <label>åº—é“ºä»£ç  * <small class="text-muted">(å¡«å†™äº¬ä¸œåº—é“ºID)</small></label>
                <input type="text" name="shop_code" class="form-control" value="" required placeholder="ä¾‹å¦‚ï¼š12919489">
            </div>
            {% endif %}
            <div class="form-group">
                <label>åº—é“ºç±»å‹ *</label>
                <select name="shop_type" class="form-control">
                    <option value="1" {{ 'selected' if shop and shop.shop_type == 1 }}>æ¸¸æˆç‚¹å¡</option>
                    <option value="2" {{ 'selected' if shop and shop.shop_type == 2 }}>é€šç”¨äº¤æ˜“</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>çŠ¶æ€</label>
                <select name="is_enabled" class="form-control">
                    <option value="1" {{ 'selected' if not shop or shop.is_enabled == 1 }}>å¯ç”¨</option>
                    <option value="0" {{ 'selected' if shop and shop.is_enabled == 0 }}>ç¦ç”¨</option>
                </select>
            </div>
            <div class="form-group">
                <label>å‘è´§æ–¹å¼</label>
                <select name="auto_deliver" class="form-control">
                    <option value="0" {{ 'selected' if not shop or shop.auto_deliver == 0 }}>æ‰‹åŠ¨å‘è´§</option>
                    <option value="1" {{ 'selected' if shop and shop.auto_deliver == 1 }}>è‡ªåŠ¨å‘è´§</option>
                </select>
            </div>
            <div class="form-group">
                <label>åˆ°æœŸæ—¶é—´</label>
                <input type="datetime-local" name="expire_time" class="form-control"
                       value="{{ shop.expire_time.strftime('%Y-%m-%dT%H:%M') if shop and shop.expire_time else '' }}">
            </div>
        </div>

        <div class="section-title">ğŸ® æ¸¸æˆç‚¹å¡é…ç½® <small class="text-muted">(å®¢æˆ·ç”³è¯·ä¸‹æ¥åå¡«å†™)</small></div>
        <div class="form-row">
            <div class="form-group">
                <label>å•†å®¶ID <small class="text-muted">(äº¬ä¸œåˆ†é…)</small></label>
                <input type="text" name="game_customer_id" class="form-control" value="{{ shop.game_customer_id or '' if shop else '' }}" placeholder="ä¾‹å¦‚ï¼š13750713">
            </div>
            <div class="form-group">
                <label>MD5å¯†é’¥ <small class="text-muted">(äº¬ä¸œåˆ†é…)</small></label>
                <input type="text" name="game_md5_secret" class="form-control" value="{{ shop.game_md5_secret or '' if shop else '' }}" placeholder="äº¬ä¸œåˆ†é…çš„MD5å¯†é’¥">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>ç›´å……å›è°ƒåœ°å€ <small class="text-muted">(äº¬ä¸œæä¾›ï¼Œé€‰å¡«)</small></label>
                <input type="text" name="game_direct_callback_url" class="form-control" value="{{ shop.game_direct_callback_url or 'https://vtpnotify.jd.com/vtp/produce/result' if shop else 'https://vtpnotify.jd.com/vtp/produce/result' }}" placeholder="é»˜è®¤: https://vtpnotify.jd.com/vtp/produce/result">
            </div>
            <div class="form-group">
                <label>å¡å¯†å›è°ƒåœ°å€ <small class="text-muted">(äº¬ä¸œæä¾›ï¼Œé€‰å¡«)</small></label>
                <input type="text" name="game_card_callback_url" class="form-control" value="{{ shop.game_card_callback_url or 'https://vtpnotify.jd.com/vtp/produce/result' if shop else 'https://vtpnotify.jd.com/vtp/produce/result' }}" placeholder="é»˜è®¤: https://vtpnotify.jd.com/vtp/produce/result">
            </div>
        </div>
        <div class="form-group">
            <label>æ¥å£åœ°å€ <small class="text-muted">(é€‰å¡«)</small></label>
            <input type="text" name="game_api_url" class="form-control" value="{{ shop.game_api_url or 'https://api.jd-game.com/v1' if shop else 'https://api.jd-game.com/v1' }}" placeholder="é»˜è®¤: https://api.jd-game.com/v1">
        </div>

        <div class="section-title">ğŸª é€šç”¨äº¤æ˜“é…ç½® <small class="text-muted">(å®¢æˆ·ç”³è¯·ä¸‹æ¥åå¡«å†™)</small></div>
        <div class="form-row">
            <div class="form-group">
                <label>å•†å®¶ID <small class="text-muted">(äº¬ä¸œåˆ†é…)</small></label>
                <input type="text" name="general_vendor_id" class="form-control" value="{{ shop.general_vendor_id or '' if shop else '' }}" placeholder="ä¾‹å¦‚ï¼š13750713">
            </div>
            <div class="form-group">
                <label>MD5å¯†é’¥ <small class="text-muted">(äº¬ä¸œåˆ†é…)</small></label>
                <input type="text" name="general_md5_secret" class="form-control" value="{{ shop.general_md5_secret or '' if shop else '' }}" placeholder="äº¬ä¸œåˆ†é…çš„MD5å¯†é’¥">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>AESå¯†é’¥ <small class="text-muted">(å¯é€‰)</small></label>
                <input type="text" name="general_aes_secret" class="form-control" value="{{ shop.general_aes_secret or '' if shop else '' }}" placeholder="å¦‚æœäº¬ä¸œæä¾›åˆ™å¡«å†™">
            </div>
            <div class="form-group">
                <label>å›è°ƒåœ°å€ <small class="text-muted">(äº¬ä¸œæä¾›ï¼Œé€‰å¡«)</small></label>
                <input type="text" name="general_callback_url" class="form-control" value="{{ shop.general_callback_url or 'https://vtpnotify.jd.com/vtp/produce/result' if shop else 'https://vtpnotify.jd.com/vtp/produce/result' }}" placeholder="é»˜è®¤: https://vtpnotify.jd.com/vtp/produce/result">
            </div>
        </div>
        <div class="form-group">
            <label>æ¥å£åœ°å€ <small class="text-muted">(é€‰å¡«)</small></label>
            <input type="text" name="general_api_url" class="form-control" value="{{ shop.general_api_url or 'https://api.jd-general.com/v1' if shop else 'https://api.jd-general.com/v1' }}" placeholder="é»˜è®¤: https://api.jd-general.com/v1">
        </div>

        <div class="section-title">ğŸ”Œ é˜¿å¥‡ç´¢é…ç½®</div>
        <div class="alert" style="background:#fff8e1;border:1px solid #ffc107;padding:12px;border-radius:4px;margin-bottom:12px;font-size:13px;">
            <b>ğŸ“‹ AccessTokenè·å–æ–¹æ³•ï¼š</b><br>
            1. åœ¨<a href="https://open.agiso.com/#/my/application/app-list" target="_blank">é˜¿å¥‡ç´¢å¼€æ”¾å¹³å°</a>åˆ›å»ºåº”ç”¨ï¼Œè·å–AppIDå’ŒAppSecret<br>
            2. å°†AppIDå‘ŠçŸ¥å•†å®¶ï¼Œå•†å®¶åœ¨<a href="https://aldsJd.agiso.com/#/open/authorize" target="_blank">æˆæƒé¡µé¢</a>æˆæƒåè·å¾—AccessToken<br>
            3. å•†å®¶å°†AccessTokenå¤åˆ¶åå¡«å…¥ä¸‹æ–¹å­—æ®µ<br>
            <small class="text-muted">æ³¨æ„ï¼šAccessTokenæœ‰æ•ˆæœŸä¸å•†å®¶è´­ä¹°é˜¿å¥‡ç´¢çš„ä½¿ç”¨æ—¶é—´ä¸€è‡´</small>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>å¯ç”¨é˜¿å¥‡ç´¢</label>
                <select name="agiso_enabled" class="form-control">
                    <option value="0" {{ 'selected' if not shop or shop.agiso_enabled == 0 }}>å¦</option>
                    <option value="1" {{ 'selected' if shop and shop.agiso_enabled == 1 }}>æ˜¯</option>
                </select>
            </div>
            <div class="form-group">
                <label>ä¸»æœºåœ°å€ <small class="text-muted">(ç•™ç©ºä½¿ç”¨å®˜æ–¹åœ°å€)</small></label>
                <input type="text" name="agiso_host" class="form-control" value="{{ shop.agiso_host or '' if shop else '' }}" placeholder="gw-api.agiso.comï¼ˆé»˜è®¤ï¼‰">
            </div>
            <div class="form-group">
                <label>ç«¯å£ <small class="text-muted">(ç•™ç©ºä½¿ç”¨443)</small></label>
                <input type="number" name="agiso_port" class="form-control" value="{{ shop.agiso_port or '' if shop else '' }}" placeholder="443">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>åº”ç”¨IDï¼ˆAppIdï¼‰</label>
                <input type="text" name="agiso_app_id" class="form-control" value="{{ shop.agiso_app_id or '' if shop else '' }}" placeholder="åœ¨é˜¿å¥‡ç´¢å¼€æ”¾å¹³å°è·å–">
            </div>
            <div class="form-group">
                <label>åº”ç”¨å¯†é’¥ï¼ˆAppSecretï¼‰</label>
                <input type="text" name="agiso_app_secret" class="form-control" value="{{ shop.agiso_app_secret or '' if shop else '' }}" placeholder="åœ¨é˜¿å¥‡ç´¢å¼€æ”¾å¹³å°è·å–">
            </div>
            <div class="form-group">
                <label>è®¿é—®ä»¤ç‰Œï¼ˆAccessTokenï¼‰
                    <small><a href="https://aldsJd.agiso.com/#/open/authorize" target="_blank">â†’ æˆæƒé¡µé¢</a></small>
                </label>
                <div style="display:flex;gap:8px;">
                    <input type="text" name="agiso_access_token" class="form-control" value="{{ shop.agiso_access_token or '' if shop else '' }}" placeholder="å•†å®¶æˆæƒåè·å–">
                    {% if shop %}
                    <button type="button" class="btn btn-sm btn-secondary" onclick="verifyAgisoToken({{ shop.id }})">éªŒè¯</button>
                    {% endif %}
                </div>
            </div>
        </div>
        {% if shop and shop.agiso_enabled %}
        <div style="margin-bottom:12px;">
            <button type="button" class="btn btn-sm btn-info" onclick="queryAgisoBalance({{ shop.id }})">ğŸ’° æŸ¥è¯¢ä½™é¢</button>
            <span id="agiso-balance-result" style="margin-left:10px;font-weight:bold;"></span>
        </div>
        {% endif %}

        <div class="section-title">ğŸ“¢ è®¢å•é€šçŸ¥é…ç½®</div>
        <div class="form-group">
            <label>å¯ç”¨è®¢å•é€šçŸ¥</label>
            <select name="notify_enabled" class="form-control" style="width:auto;">
                <option value="0" {{ 'selected' if not shop or shop.notify_enabled == 0 }}>å¦</option>
                <option value="1" {{ 'selected' if shop and shop.notify_enabled == 1 }}>æ˜¯</option>
            </select>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>é’‰é’‰ Webhook åœ°å€</label>
                <input type="text" name="dingtalk_webhook" class="form-control" value="{{ shop.dingtalk_webhook or '' if shop else '' }}" placeholder="https://oapi.dingtalk.com/robot/send?access_token=xxx">
            </div>
            <div class="form-group">
                <label>é’‰é’‰åŠ ç­¾å¯†é’¥</label>
                <input type="text" name="dingtalk_secret" class="form-control" value="{{ shop.dingtalk_secret or '' if shop else '' }}">
            </div>
        </div>
        {% if shop %}
        <div class="mb-4">
            <button type="button" class="btn btn-sm" onclick="testNotification({{ shop.id }}, 'dingtalk')">ğŸ“¤ æµ‹è¯•é’‰é’‰é€šçŸ¥</button>
        </div>
        {% endif %}
        <div class="form-group">
            <label>ä¼ä¸šå¾®ä¿¡ Webhook åœ°å€</label>
            <input type="text" name="wecom_webhook" class="form-control" value="{{ shop.wecom_webhook or '' if shop else '' }}" placeholder="https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxx">
        </div>
        {% if shop %}
        <div class="mb-4">
            <button type="button" class="btn btn-sm" onclick="testNotification({{ shop.id }}, 'wecom')">ğŸ“¤ æµ‹è¯•ä¼ä¸šå¾®ä¿¡é€šçŸ¥</button>
        </div>
        {% endif %}

        <div class="form-group">
            <label>å¤‡æ³¨</label>
            <textarea name="remark" class="form-control" rows="3">{{ shop.remark or '' if shop else '' }}</textarea>
        </div>

        <div class="flex gap-2 mt-4">
            <button type="submit" class="btn btn-primary">ä¿å­˜</button>
            <a href="{{ url_for('shop.shop_list') }}" class="btn">å–æ¶ˆ</a>
        </div>
    </form>
</div>

<script>
function testNotification(shopId, type) {
    fetch('/api/shop/test-notification', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({shop_id: shopId, notify_type: type})
    })
    .then(res => res.json())
    .then(data => {
        alert(data.success ? 'âœ… ' + data.message : 'âŒ ' + data.message);
    });
}

function verifyAgisoToken(shopId) {
    fetch('/shop/agiso-verify-token', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({shop_id: shopId})
    })
    .then(res => res.json())
    .then(data => {
        alert(data.success ? 'âœ… Tokenæœ‰æ•ˆï¼' + data.message : 'âŒ Tokenæ— æ•ˆï¼š' + data.message);
    });
}

function queryAgisoBalance(shopId) {
    const el = document.getElementById('agiso-balance-result');
    el.textContent = 'æŸ¥è¯¢ä¸­...';
    fetch('/shop/agiso-balance/' + shopId)
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            el.textContent = 'ğŸ’° ' + data.message;
            el.style.color = '#28a745';
        } else {
            el.textContent = 'âŒ ' + data.message;
            el.style.color = '#dc3545';
        }
    });
}
</script>
{% endblock %}
