{% extends "layouts/base.html" %}
{% block title %}å•†å“ç®¡ç†{% endblock %}

{% block content %}
<div class="card">
    <div class="flex justify-between items-center mb-4">
        <div class="card-title">ğŸ›ï¸ å•†å“ç®¡ç†</div>
        <a href="{{ url_for('product.product_create') }}" class="btn btn-primary">+ æ–°å»ºå•†å“é…ç½®</a>
    </div>

    <!-- è¯´æ˜ -->
    <div class="alert alert-info mb-3" style="background:#e6f7ff;border:1px solid #91d5ff;padding:12px;border-radius:4px;font-size:13px;">
        <strong>ğŸ“‹ ä½¿ç”¨è¯´æ˜ï¼š</strong>åœ¨æ­¤ä¸ºæ¯ä¸ªäº¬ä¸œSKUé…ç½®å‘è´§æ–¹å¼ã€‚<br>
        â€¢ <strong>æ‰‹åŠ¨å‘è´§</strong>ï¼šæ”¶åˆ°è®¢å•åæ‰‹åŠ¨æ“ä½œé€šçŸ¥å‘è´§<br>
        â€¢ <strong>91å¡åˆ¸å¡å¯†</strong>ï¼šæ”¶åˆ°è®¢å•åè‡ªåŠ¨ä»91å¡åˆ¸ä»“åº“æå–å¡å¯†å‘è´§<br>
        â€¢ <strong>ç›´å……APIï¼ˆé¢„ç•™ï¼‰</strong>ï¼šåç»­å¯¹æ¥ç›´å……è´§æºæ–¹ä½¿ç”¨
    </div>

    <!-- æœç´¢ç­›é€‰ -->
    <form method="GET" class="mb-4">
        <div class="form-row">
            <div class="form-group">
                <input type="text" name="keyword" class="form-control" 
                       placeholder="å•†å“åç§°/SKU ID/å¥—é¤å" 
                       value="{{ request.args.get('keyword', '') }}">
            </div>
            <div class="form-group">
                <select name="shop_id" class="form-control">
                    <option value="">å…¨éƒ¨åº—é“º</option>
                    {% for shop in shops %}
                    <option value="{{ shop.id }}" {{ 'selected' if request.args.get('shop_id') == shop.id|string }}>
                        {{ shop.shop_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <select name="deliver_type" class="form-control">
                    <option value="">å…¨éƒ¨å‘è´§æ–¹å¼</option>
                    <option value="0" {{ 'selected' if request.args.get('deliver_type') == '0' }}>æ‰‹åŠ¨å‘è´§</option>
                    <option value="1" {{ 'selected' if request.args.get('deliver_type') == '1' }}>91å¡åˆ¸å¡å¯†</option>
                    <option value="2" {{ 'selected' if request.args.get('deliver_type') == '2' }}>ç›´å……APIï¼ˆé¢„ç•™ï¼‰</option>
                </select>
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary">ğŸ” æœç´¢</button>
                <a href="{{ url_for('product.product_list') }}" class="btn">é‡ç½®</a>
            </div>
        </div>
    </form>

    <!-- å•†å“åˆ—è¡¨ -->
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>å•†å“åç§°</th>
                    <th>æ‰€å±åº—é“º</th>
                    <th>SKU ID</th>
                    <th>å¥—é¤åç§°</th>
                    <th>å‘è´§æ–¹å¼</th>
                    <th>91å¡åˆ¸å¡ç§</th>
                    <th>çŠ¶æ€</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% if products %}
                    {% for product in products %}
                    <tr>
                        <td>
                            <strong>{{ product.product_name }}</strong>
                            {% if product.jd_product_id %}
                            <br><small class="text-muted">äº¬ä¸œIDï¼š{{ product.jd_product_id }}</small>
                            {% endif %}
                        </td>
                        <td>{{ product.shop.shop_name if product.shop else '-' }}</td>
                        <td>
                            {% if product.sku_id %}
                            <code>{{ product.sku_id }}</code>
                            {% else %}
                            <span class="text-muted">æœªè®¾ç½®</span>
                            {% endif %}
                        </td>
                        <td>{{ product.sku_name or '-' }}</td>
                        <td>
                            {% if product.deliver_type == 0 %}
                            <span class="badge badge-default">ğŸ‘‹ æ‰‹åŠ¨å‘è´§</span>
                            {% elif product.deliver_type == 1 %}
                            <span class="badge badge-success">ğŸ« 91å¡åˆ¸å¡å¯†</span>
                            {% elif product.deliver_type == 2 %}
                            <span class="badge badge-info">âš¡ ç›´å……APIï¼ˆé¢„ç•™ï¼‰</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if product.deliver_type == 1 and product.card91_card_type_id %}
                            <span title="å¡ç§IDï¼š{{ product.card91_card_type_id }}">
                                {{ product.card91_card_type_name or product.card91_card_type_id }}
                            </span>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if product.is_enabled == 1 %}
                            <span class="badge badge-success">å¯ç”¨</span>
                            {% else %}
                            <span class="badge badge-danger">ç¦ç”¨</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('product.product_edit', product_id=product.id) }}" class="btn btn-sm">ç¼–è¾‘</a>
                            <form method="POST" action="{{ url_for('product.product_delete', product_id=product.id) }}" 
                                  style="display:inline;" onsubmit="return confirm('ç¡®è®¤åˆ é™¤æ­¤å•†å“é…ç½®ï¼Ÿ')">
                                <button type="submit" class="btn btn-sm btn-danger">åˆ é™¤</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="8" class="text-center text-muted" style="padding: 40px;">
                            æš‚æ— å•†å“é…ç½®ï¼Œ<a href="{{ url_for('product.product_create') }}">ç‚¹å‡»æ–°å»º</a>
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- åˆ†é¡µ -->
    {% if pagination.pages > 1 %}
    <div class="pagination">
        {% if pagination.has_prev %}
        <a href="{{ url_for('product.product_list', page=pagination.prev_num, **request.args) }}" class="btn btn-sm">ä¸Šä¸€é¡µ</a>
        {% endif %}
        <span class="text-muted">ç¬¬ {{ pagination.page }} / {{ pagination.pages }} é¡µï¼Œå…± {{ pagination.total }} æ¡</span>
        {% if pagination.has_next %}
        <a href="{{ url_for('product.product_list', page=pagination.next_num, **request.args) }}" class="btn btn-sm">ä¸‹ä¸€é¡µ</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
