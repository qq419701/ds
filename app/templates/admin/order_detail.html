{% extends "base.html" %}
{% block title %}è®¢å•è¯¦æƒ… - {{ order.order_id }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>ğŸ“¦ è®¢å•è¯¦æƒ…</h2>
    <a href="{{ url_for('admin.order_list') }}" class="btn btn-outline-secondary">â† è¿”å›åˆ—è¡¨</a>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header bg-dark text-white">åŸºæœ¬ä¿¡æ¯</div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr><th width="150">è®¢å•å·</th><td>{{ order.order_id }}</td></tr>
                    <tr><th>ç±»å‹</th><td>{{ 'æ¸¸æˆç‚¹å¡' if order.shop_type == 1 else 'é€šç”¨äº¤æ˜“' }} / {{ 'ç›´å……' if order.order_type == 1 else 'å¡å¯†' }}</td></tr>
                    <tr><th>çŠ¶æ€</th><td>
                        {% if order.order_status == 0 %}<span class="badge bg-warning">å¾…å¤„ç†</span>
                        {% elif order.order_status == 1 %}<span class="badge bg-info">å¤„ç†ä¸­</span>
                        {% elif order.order_status == 2 %}<span class="badge bg-success">å·²å®Œæˆ</span>
                        {% elif order.order_status == 4 %}<span class="badge bg-danger">å·²é€€æ¬¾</span>
                        {% endif %}
                    </td></tr>
                    <tr><th>å›è°ƒçŠ¶æ€</th><td>{{ 'æœªå›è°ƒ' if order.notify_status == 0 else ('æˆåŠŸ' if order.notify_status == 1 else 'å¤±è´¥') }}</td></tr>
                    {% if order.game_account %}<tr><th>æ¸¸æˆè´¦å·</th><td>{{ order.game_account }}</td></tr>{% endif %}
                    {% if order.produce_account %}<tr><th>å……å€¼è´¦å·</th><td>{{ order.produce_account }}</td></tr>{% endif %}
                    <tr><th>æ•°é‡</th><td>{{ order.buy_num or order.quantity or '-' }}</td></tr>
                    <tr><th>é‡‘é¢</th><td>{{ order.total_price or '-' }}</td></tr>
                    <tr><th>åˆ›å»ºæ—¶é—´</th><td>{{ order.created_at.strftime('%Y-%m-%d %H:%M:%S') if order.created_at else '-' }}</td></tr>
                </table>
            </div>
        </div>

        {% if order.card_info %}
        <div class="card mb-4">
            <div class="card-header bg-success text-white">å¡å¯†ä¿¡æ¯</div>
            <div class="card-body">
                <pre class="mb-0">{{ order.card_info }}</pre>
            </div>
        </div>
        {% endif %}
    </div>

    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header bg-secondary text-white">æ“ä½œ</div>
            <div class="card-body">
                {% if order.order_status in [0, 1] %}
                {% if order.order_type == 1 %}
                <form method="post" action="{{ url_for('admin.order_success', order_id=order.id) }}" class="mb-2">
                    <button type="submit" class="btn btn-success w-100" onclick="return confirm('ç¡®è®¤é€šçŸ¥æˆåŠŸï¼Ÿ')">âœ… é€šçŸ¥æˆåŠŸï¼ˆç›´å……ï¼‰</button>
                </form>
                {% else %}
                <div class="mb-2">
                    <label class="form-label">å¡å¯†JSONï¼ˆæ•°ç»„æ ¼å¼ï¼‰</label>
                    <textarea name="card_info" id="card_info" class="form-control" rows="4" placeholder='[{"cardNo":"xxx","cardPass":"xxx"}]'></textarea>
                </div>
                <form method="post" action="{{ url_for('admin.order_send_card', order_id=order.id) }}" class="mb-2" id="card_form">
                    <input type="hidden" name="card_info" id="card_info_hidden">
                    <button type="button" class="btn btn-primary w-100" onclick="submitCard()">ğŸƒ å‘é€å¡å¯†</button>
                </form>
                {% endif %}
                <form method="post" action="{{ url_for('admin.order_refund', order_id=order.id) }}">
                    <button type="submit" class="btn btn-danger w-100" onclick="return confirm('ç¡®è®¤é€šçŸ¥é€€æ¬¾ï¼Ÿ')">ğŸ’¸ é€šçŸ¥é€€æ¬¾</button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
function submitCard() {
    var cardInfo = document.getElementById('card_info').value;
    document.getElementById('card_info_hidden').value = cardInfo;
    if (confirm('ç¡®è®¤å‘é€å¡å¯†ï¼Ÿ')) {
        document.getElementById('card_form').submit();
    }
}
</script>
{% endblock %}
