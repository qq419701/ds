接入指南
1、接入流程
【开发者操作】登录后台申请AppIds。
入口：https://open.agiso.com/#/my/application/app-list
【开发者操作】申请到AppId后，开发者可以登录后台管理AppId，这里可以查看和更换AppSecret、更改推送url、更改授权回调url等。
入口：https://open.agiso.com/#/my/application/app-list
【商家操作】授权，方法有二：
1、输入开发者提供的AppId（相当于告诉Agiso，允许这个AppId通过Agiso开放平台获取或操作商家自己的订单数据），勾选相应要授权的权限。授权后会显示一个Token，将Token复制给开发者。
入口：https://mai.91kami.com/#/open/authorize
2、开发者如果有开发自动授权，则商家可以通过访问以下页面进行授权：
入口：https://mai.91kami.com/#/authorize?appId={$开发者应用的AppId}&state={$开发者自定义参数}
【开发者操作】开发者得到各个商家授权给的Token，并使用Token调用接口。调用接口时，需要使用AppSecret进行签名，具体签名方法参见下文。
注意：开发者与商家，也可以是同一个人。
2、获取AccessToken详解
手动模式自动模式
将你的AppId告诉您的用户，用户通过在授权页面(https://mai.91kami.com/#/open/authorize)进行授权。
          用户授权完成后，会获得一个AccessToken，让您的用户把该AccessToken发给你。 AccessToken的有效期和您的用户购买Agiso软件的使用时间一致。如果您的用户续费，那么AccessToken的有效期也会延长。
1、接入流程 

 

          拼接用户授权需访问url ，示例及参数说明如下：
          https://mai.91kami.com/#/authorize?appId={$开发者应用的AppId}&state={$开发者自定义参数}
        

 
appId
是
long
应用的appId
state
否
string
开发者自定义参数，授权回调会把该参数回传回去
 
2、引导用户登录授权

 
          引导用户通过浏览器访问以上授权url
         
3、获取code

 
          用户点“授权”按钮后，Agiso自动发货会将授权码code、自定义参数state返回到了回调地址上，应用可以获取并使用该code去换取AccessToken
         
4、换取AccessToken

 
          通过访问 https://mai.91kami.com/auth/token?code={$实际获取到的code}&appId={$开发者应用的AppId}&sign={$md5后的签名}
          获取AccessToken换取AccessToken请求参数说明
         
appId
是
long
应用的appId
code
是
string
上一步获取code得到
sign
是
string
跟接口的签名算法一致，md5({$开发者应用的AppSecret}appId{$开发者应用的AppId}code{$实际获取到的code}{$开发者应用的AppSecret})
 
换取AccessToken返回值示例

 
IsSuccess: true,
Error_Code: 0,
Error_Msg: "",
Data:{
    "FromPlatform":"TbAcs"
    "UserId":123456,
    "UserNick":"用户昵称",
    "SubUserId": 100,
    "SubUserNick":"子用户昵称",
    "ShopName":"卡券店铺",
    "ExpiresIn":165486,
    "Token":"alds_afoiqhwfaldhfoaseio"
  }
 
换取AccessToken返回参数说明

 
FromPlatform
string
平台，参数值：TbAcs,TbAlds,TbArs,Print,Acpr,PddAlds,AldsIdle,AldsJd,AldsDoudian,AldsKwai,AldsYouzan,AldsWeidian,AldsWxVideoShop,AldsXhs,Open
UserId
string
用户Id
UserNick
string
用户昵称
SubUserId
long
子用户Id
SubUserNick
string
子用户昵称
ExpiresIn
int
AccessToken过期时间（表示 n 秒后过期）
Token
string
AccessToken


3、调用接口详解
调用任何一个API都必须把AccessToken 和 ApiVersion 添加到Header ,格式为"Authorization: Bearer access_token"，其中Bearer后面有一个空格。同时还需传入以下公共参数：
timestamp
是
Date
时间戳，例如：1468476350。API服务端允许客户端请求最大时间误差为10分钟。
sign
是
string
API输入参数签名结果,签名算法参照下面的介绍。
注意：接口调用配额，20次/秒。
4、签名算法
【对所有API请求参数（包括公共参数和业务参数，但除去sign参数和byte[]类型的参数），根据参数名称的ASCII码表的顺序排序。如：foo=1, bar=2, foo_bar=3, foobar=4排序后的顺序是bar=2, foo=1, foo_bar=3, foobar=4。
将排序好的参数名和参数值拼装在一起，根据上面的示例得到的结果为：bar2foo1foo_bar3foobar4。
把拼装好的字符串采用utf-8编码，在拼装的字符串前后加上app的secret后，使用MD5算法进行摘要，如：md5({$开发者应用的AppSecret}bar2foo1foo_bar3foobar4{$开发者应用的AppSecret})
5、Header设置示例代码
JavaC#PHPPython

  HttpPost httpPost = new org.apache.http.client.methods.HttpPost(url);
  httpPost.addHeader("Authorization","Bearer "+ accessToken);
  httpPost.addHeader("ApiVersion", "1");

Python
headers = {
    "Authorization": f"Bearer {access_token}",
    "ApiVersion": "1"
  }
  response = requests.post(url, headers=headers)

6、签名算法示例代码
JavaC#PHPPython
 
  Map<String, String> data = new HashMap<String, String>();
  data.put("modifyTimeStart", "2016-07-13 10:44:30");
  data.put("pageNo", "1");
  data.put("pageSize", "20");
  //timestamp 为调用Api的公共参数，详细说明参考接入指南
  data.put("timestamp", '1468476350');//假设当前时间为2016/7/14 14:5:50
  //对键排序
  String[] keys = data.keySet().toArray(new String[0]);
  Arrays.sort(keys);
  StringBuilder query = new StringBuilder();
  //头加入AppSecret ，假设AppSecret值为******************
  query.append(this.getClientSecret());
  for (String key : keys) {
      String value = data.get(key);
      query.append(key).append(value);
  }
  //到这query的值为******************modifyTimeStart2016-07-13 10:44:30pageNo1pageSize20timestamp1468476350
  //尾加入AppSecret
  query.append(this.getClientSecret()); //query=******************modifyTimeStart2016-07-13 10:44:30pageNo1pageSize20timestamp1468476350******************
  byte[] md5byte = encryptMD5(query.toString());
  //sign 为调用Api的公共参数，详细说明参考接入指南
  data.put("sign", byte2hex(md5byte)); //byte2hex(md5byte) = 935671331572EBF7F419EBB55EA28558
  
  // Md5摘要
  public byte[] encryptMD5(String data) throws NoSuchAlgorithmException, UnsupportedEncodingException {
      MessageDigest md5 = MessageDigest.getInstance("MD5");
      return md5.digest(data.getBytes("UTF-8"));
  }

  public String byte2hex(byte[] bytes) {
      StringBuilder sign = new StringBuilder();
      for (int i = 0; i < bytes.length; i++) {
          String hex = Integer.toHexString(bytes[i] & 0xFF);
          if (hex.length() == 1) {
              sign.append("0");
          }
          sign.append(hex.toLowerCase());
      }
      return sign.toString();
  }

Python
import hashlib
  from collections import OrderedDict
  
  def generate_sign(params, app_secret):
      # 1. 对参数键按字典序排序
      sorted_params = OrderedDict(sorted(params.items(), key=lambda x: x[0]))
  
      # 2. 拼接字符串：首尾加入 client_secret
      query_str = app_secret
      for key, value in sorted_params.items():
          query_str += f"{key}{value}"
      query_str += app_secret
  
      # 3. 计算 MD5 并转为小写十六进制
      md5 = hashlib.md5()
      md5.update(query_str.encode('utf-8'))
      sign = md5.hexdigest().lower()
      return sign
  
  # 示例使用
  if __name__ == "__main__":
      # 准备参数
      params = {
          "tids": "1234567789",
          "timestamp": "1468476350"  # 假设当前时间为 2016/7/14 14:5:50
      }
      app_secret = "******************"  # 替换为实际 AppSecret
  
      # 生成签名并添加到参数
      sign = generate_sign(params, app_secret)
      params["sign"] = sign

7、完整调用API示例代码
以下代码以调用LogisticsDummySend(更新发货状态)为例
JavaC#PHPPython

  public String logisticsDummySend() {
      String appSecret = "******************";
      String accessToken = "*************************";

      CloseableHttpClient httpclient = HttpClients.createDefault();
      HttpPost httpPost = new HttpPost("https://gw-api.agiso.com/acpr/Trade/LogisticsDummySend");
      // 设置头部
      httpPost.addHeader("Authorization", "Bearer " + accessToken);
      httpPost.addHeader("ApiVersion", "1");
      //业务参数
      Map<String, String> data = new HashMap<String, String>();
      String tids = "1234567789,9874561233";
      data.put("tids", tids); 注意 tids是示例参数实际参数要以当前文档上的入参为准！！！
      Long timestamp = System.currentTimeMillis() / 1000;
      data.put("timestamp", timestamp.toString());
      // 参数签名
      try {
          data.put("sign", sign(data, appSecret));
      } catch (NoSuchAlgorithmException e) {
          e.printStackTrace();
      } catch (UnsupportedEncodingException e) {
          e.printStackTrace();
      }
      List<BasicNameValuePair> params = new ArrayList<BasicNameValuePair>();
      for (Map.Entry<String, String> entry : data.entrySet()) {
          params.add(new BasicNameValuePair(entry.getKey(), entry.getValue()));
      }
      // 发起POST请求
      try {
          httpPost.setEntity(new UrlEncodedFormEntity(params, "UTF-8"));
          HttpResponse httpResponse = httpclient.execute(httpPost);
          if (httpResponse.getStatusLine().getStatusCode() == HttpStatus.SC_OK) {
              return EntityUtils.toString(httpResponse.getEntity());
          } else {
              return ("doPost Error Response: " + httpResponse.getStatusLine().toString());
          }
      } catch (Exception e) {
          e.printStackTrace();
          return null;
      }
  }

  // 参数签名
  public String sign(Map<String, String> params, String appSecret)
          throws NoSuchAlgorithmException, UnsupportedEncodingException {
      String[] keys = params.keySet().toArray(new String[0]);
      Arrays.sort(keys);

      StringBuilder query = new StringBuilder();
      query.append(appSecret);
      for (String key : keys) {
          String value = params.get(key);
          query.append(key).append(value);
      }
      query.append(appSecret);

      byte[] md5byte = encryptMD5(query.toString());

      return byte2hex(md5byte);
  }

  // byte数组转成16进制字符串
  public static String byte2hex(byte[] bytes) {
      StringBuilder sign = new StringBuilder();
      for (int i = 0; i < bytes.length; i++) {
          String hex = Integer.toHexString(bytes[i] & 0xFF);
          if (hex.length() == 1) {
              sign.append("0");
          }
          sign.append(hex.toLowerCase());
      }
      return sign.toString();
  }

  // Md5摘要
  public static byte[] encryptMD5(String data) throws NoSuchAlgorithmException, UnsupportedEncodingException {
      MessageDigest md5 = MessageDigest.getInstance("MD5");
      return md5.digest(data.getBytes("UTF-8"));
  }

Python
import hashlib
  import time
  import requests
  from urllib.parse import urlencode
  
  class AgisoApiClient:
      def __init__(self, app_secret, access_token):
          self.app_secret = app_secret
          self.access_token = access_token
          self.api_url = "https://gw-api.agiso.com/acpr/Trade/LogisticsDummySend"
  
      def logistics_dummy_send(self, tids):
          """模拟发货接口调用"""
          # 1. 准备基础参数
          params = {
              "tids": tids,
              "timestamp": str(int(time.time()))  # 当前时间戳（秒级）
          }
  
          # 2. 生成签名
          try:
              params["sign"] = self._generate_sign(params)
          except Exception as e:
              print(f"生成签名失败: {e}")
              return None
  
          # 3. 设置请求头
          headers = {
              "Authorization": f"Bearer {self.access_token}",
              "ApiVersion": "1",
              "Content-Type": "application/x-www-form-urlencoded"
          }
  
          # 4. 发送POST请求
          try:
              response = requests.post(
                  self.api_url,
                  data=urlencode(params),  # 表单编码
                  headers=headers
              )
  
              if response.status_code == 200:
                  return response.text
              else:
                  return f"Error Response: {response.status_code} - {response.text}"
          except Exception as e:
              print(f"请求发送失败: {e}")
              return None
  
      def _generate_sign(self, params):
          """生成MD5签名"""
          # 1. 参数按键名排序
          sorted_params = sorted(params.items(), key=lambda x: x[0])
  
          # 2. 拼接签名字符串
          query_str = self.app_secret
          for key, value in sorted_params:
              query_str += f"{key}{value}"
          query_str += self.app_secret
  
          # 3. 计算MD5并转为小写十六进制
          md5 = hashlib.md5()
          md5.update(query_str.encode('utf-8'))
          return md5.hexdigest().lower()
  
  # 使用示例
  if __name__ == "__main__":
      # 替换为实际值
      APP_SECRET = "******************"
      ACCESS_TOKEN = "*************************"
      TIDS = "1234567789"  # 示例参数，需按文档调整
  
      client = AgisoApiClient(APP_SECRET, ACCESS_TOKEN)
      result = client.logistics_dummy_send(TIDS)
      print("接口响应:", result)


提卡
简要描述：  接口调用示例

￥高级
提卡
请求URL：

https://gw-api.agiso.com/acpr/CardPwd/HandPick
请求方式：

POST
公共Header：

公共参数：

参数：

cpkId
是
Long
卡种Id
num
是
Int
提卡数量
handPickOrderId
是
String
接入方订单编号
buyer
否
String
买家名称
buildCpd
否
Bool
生成完整卡券提取链接，默认False
usePriority
否
Bool
优先出库标识为“优先出售”的卡密，默认True
返回示例


      {
        "IsSuccess": true,
        "Data": {
          // buildCpd传true时返回
          "CpdUrl": "https://mai.91kami.com/cpd/lu3hmk684kfch1n9wfauphnkx7eyrncqf78a39462da14270bd8666333404d81b.aspx" 
          //buildCpd传false时返回
          "CardPwdArr": [
            {
              "c": "xx003",              // 卡号
              "p": "123",                // 密码
              "d": "2024-11-21 23:59:59" // 到期时间
            }
          ]
        },
        "Error_Code": 0,
        "Error_Msg": "",
        "AllowRetry": null,
        "RequestId": "20211108142251106"
      }
      
返回参数说明

CpdUrl
String
请求参数 “buildCpd” 为 true 返回链接地址
CardPwdArr
String
请求参数 “buildCpd” 为 false 时返回卡密信息集合如：[ {"c":"卡号1", "p":"密码1", "d":"2024-11-15 23:59:59"},{"c":"卡号2", "p":"密码3", "d":"2024-11-15 23:59:59"} ]



加卡
简要描述：  接口调用示例

￥基础
用于添加卡密。该功能需配合「创建入库批次号」接口使用
请求URL：

https://gw-api.agiso.com/acpr/CardPwd/StockIn
请求方式：

POST
公共Header：

公共参数：

参数：

stockInBatchId
是
String
入库批次号
data
是
String
卡券内容，内容格式需要根据卡种类型，具体查看备注
isUseFirst
否
Bool
优先出售
allowReplace
否
Bool
覆盖已存在的
expireTime
否
String
注：卡种开启到期日时必填，其他忽略
返回示例


        {
          "IsSuccess": true,
          "Data": {
            "AddFailCount": 0,
            "AddSuccessCount": 2,
            "ReplaceSoldSuccessCount": 0,
            "ReplaceUnSoldSuccessCount": 0,
            "ResultMsg": ""
          },
          "Error_Code": 0,
          "Error_Msg": "",
          "AllowRetry": null,
          "RequestId": "20211108142251106"
        }
        
返回参数说明

AddFailCount
Int
添加失败数量
AddSuccessCount
String
添加成功数量
ReplaceSoldSuccessCount
String
覆盖成功数量
ReplaceUnSoldSuccessCount
String
覆盖失败
ResultMsg
String
消息内容
备注

卡种类型对应加卡"data"参数JSON格式例子：
700:循环卡:[{"CardNo":"卡号","Pwd":"卡密"}]
800:套卡：[{"CardNo":"卡号"}]
820:唯一卡：[{"CardNo":"卡号","Pwd":"卡密"}]
840:重复卡：[{"CardNo":"卡号","Pwd":"卡密"}]
850:图片卡：[{"Url":"图片URL地址","Md5":"图片M5d值","OriName":"图片名称"}]

如果只有卡号没有卡密的场景，Pwd就不用传了。eg：820:唯一卡：[{"CardNo":"卡号"}]


获取卡种列表
简要描述：  接口调用示例

￥基础
获取卡种列表
请求URL：

https://gw-api.agiso.com/acpr/CardPwd/GetList
请求方式：

POST
公共Header：

公共参数：

参数：

pageIndex
是
Long
页码默认 1
pageSize
是
Long
默认100，最大100
filterName
否
String
卡种名称，支持模糊匹配
classId
否
Int
卡种分类Id
返回示例


        {
          "IsSuccess": true,
          "Data": {
            {
              "List":[
                {
                  "IdNo":123110,
                  "CardType":820,
                  "Title":"测试Jd",
                  "RemainingCount":13,
                  "UsedCount":1,
                  "TotalCount":14,
                  "CreateTime":"2021-06-15 18:43:16",
                  "PurPrice":"1"
                }
              ],
              "TotalCount":65,
              "PageNo":1,
              "PageSize":20
            }
          },
          "Error_Code": 0,
          "Error_Msg": "",
          "AllowRetry": null,
          "RequestId": "20211108142251106"
        }
        
返回参数说明

IdNo
Long
Id
CardType
Long
卡种类型
title
String
卡种名称
RemainingCount
Int
库存
UsedCount
Int
已用数量
TotalCount
Int
总数量
CreateTime
String
创建时间
PurPrice
Decimal
成本单价
备注

卡种类型：700:循环卡、800:套卡、820:唯一卡、840:重复卡、850:图片卡

获取卡种详情
简要描述：  接口调用示例

￥基础
获取卡种详情
请求URL：

https://gw-api.agiso.com/acpr/CardPwdKind/GetDetails
请求方式：

POST
公共Header：

公共参数：

参数：

cpkId
是
Long
卡种Id
返回示例


          {
            "IsSuccess": true,
            "Data": {
              "IdNo": 32,
              "Title": "京东激活码",
              "AliasName": null,
              "ClassId": 0,
              "Sort": 0,
              "WarningNum": 5,
              "TotalCount": 3,
              "UsedCount": 1,
              "LockingCount": 0,
              "CardType": 800,
              "CardNoShowType": 0,
              "PwdShowType": 0,
              "ShowTpl": "{卡号}",
              "PrefixCardNo": "",
              "PrefixPwd": "",
              "SplitCardPwd": null,
              "PurPrice": 0.00000000,
              "ModifyTime": "2017-12-07T16:59:54",
              "CreateTime": "2017-12-07T16:40:59"
            },
            "Error_Code": 0,
            "Error_Msg": "",
            "AllowRetry": null,
            "RequestId": "20211122942251106"
          }
          
返回参数说明

IdNo
Long
Id
title
String
卡种名称
AliasName
String
卡种别名
ClassId
Long
卡种分类
Sort
Int
排序
WarningNum
Int
预警数量
TotalCount
Int
总数量
UsedCount
Int
已用数量
LockingCount
Int
锁定数量
CardType
Long
卡种类型
CardNoShowType
Int
卡号显示类型
PwdShowType
Int
密码显示类型
ShowTpl
String
显示模板
PrefixCardNo
String
卡号前缀
PrefixPwd
String
密码前缀
SplitCardPwd
String
分隔符
PurPrice
Decimal
成本单价
ModifyTime
String
修改时间
CreateTime
String
创建时间
备注

卡种类型：700:循环卡、800:套卡、820:唯一卡、840:重复卡、850:图片卡
卡号及密码显示类型：0:文本、1:条形码、2:二维码、4:条形码+二维码

创建入库批次号
简要描述：  接口调用示例

￥基础
加卡需先创建入库批次号，批次号有效时间为30分钟。详见「加卡」接口文档。
请求URL：

https://gw-api.agiso.com/acpr/CardPwd/CreateStockInBatchId
请求方式：

POST
公共Header：

公共参数：

参数：

cpkId
是
Long
卡种Id
price
否
Decimal
成本单价
summary
否
String
批次描述
返回示例


          {
            "IsSuccess": true,
            "Data": "fe71483c21a846b58e0c369224eee38f",
            "Error_Code": 0,
            "Error_Msg": "",
            "AllowRetry": null,
            "RequestId": "20211108142251106"
          }
          
返回参数说明

Data
String
批次号

查询开放平台余额
简要描述：  接口调用示例

￥基础
无需授权
查询开放平台余额
请求URL：

https://gw-api.agiso.com/open/Bankroll/QueryDeposit
请求方式：

POST
公共Header：

公共参数：

参数：

No Data
返回示例


    {
      "IsSuccess": true,
      "Data": 9610.737, // 余额
      "Error_Code": 0,
      "Error_Msg": "",
      "AllowRetry": null,
      "RequestId": "2023022717413855"
    }

获取发卡方案列表
简要描述：  接口调用示例

￥基础
获取发卡方案列表
请求URL：

https://gw-api.agiso.com/acpr/SendCardPlan/getlist
请求方式：

POST
公共Header：

公共参数：

参数：

pageIndex
是
Long
页码默认 1
pageSize
是
Long
默认20
filterName
否
String
发卡方案名称
返回示例


          {
            "IsSuccess": true,
            "Data": {
              "List": [
                {
                    "IdNo": 193,
                    "Title": "多组合随机选一",
                    "PlanType": 6,
                    "PlanJson": "[[{"Name":"n1","GroupCard":[{"Denom":1.0,"CpkId":721}]}],[{"Name":"n2","GroupCard":[{"Denom":1.0,"CpkId":720}]}]]", // 多组合随机选一 Json字符串数据结构 
                    "CardKindIds": ",721,720,",
                    "CreateTime": "2023-03-21 10:38:37",
                    "ModifyTime": "2023-03-21 10:41:49",
                    "ShowName": "多组合随机选一"
                },
                {
                    "IdNo": 192,
                    "Title": "多组合顺序选一",
                    "PlanType": 5,
                    "PlanJson": "[[{"Name":"n1","GroupCard":[{"Denom":1.0,"CpkId":716}]}],[{"Name":"n2","GroupCard":[{"Denom":1.0,"CpkId":714}]}]]", // 多组合顺序选一 Json字符串数据结构 
                    "CardKindIds": ",716,714,",
                    "CreateTime": "2023-03-21 10:32:07",
                    "ShowName": "多组合顺序选一"
                },
                {
                    "IdNo": 191,
                    "Title": "按留言组合",
                    "PlanType": 4,
                    "PlanJson": "[{"Keyword":"ka1","Pri":1,"GroupCard":[{"Denom":1.0,"CpkId":721}]}]", // 按留言组合 Json字符串数据结构 
                    "CardKindIds": ",721,",
                    "CreateTime": "2023-03-21 10:30:14",
                    "ShowName": "按留言组合"
                },
                {
                    "IdNo": 190,
                    "Title": "按地址",
                    "PlanType": 3,
                    "PlanJson": "[{"Keyword":"厦门","Pri":1,"GroupCard":[{"Denom":1.0,"CpkId":719}]},{"Keyword":"福州","Pri":2,"GroupCard":[{"Denom":1.0,"CpkId":721}]}]", // 按地址 Json字符串数据结构 
                    "CardKindIds": ",719,721,",
                    "CreateTime": "2023-03-21 10:28:25",
                    "ShowName": "按地址"
                },
                {
                    "IdNo": 189,
                    "Title": "按数量组合",
                    "PlanType": 1,
                    "PlanJson": "[{"BuyNum":1,"GroupCard":[{"Num":1,"CpkId":721},{"Num":1,"CpkId":719}]}]", // 按数量组合 Json字符串数据结构 
                    "CardKindIds": ",721,719,",
                    "CreateTime": "2023-03-21 10:19:06",
                    "ShowName": "按数量组合"
                },
                {
                    "IdNo": 188,
                    "Title": "普通组合",
                    "PlanType": 0,
                    "PlanJson": "[{"Denom":1.0,"CpkId":721},{"Denom":2.0,"CpkId":720}]", // 普通组合 Json字符串数据结构 
                    "CardKindIds": ",721,720,",
                    "CreateTime": "2023-03-21 10:18:25",
                    "ShowName": "普通组合"
                },
                {
                    "IdNo": 187,
                    "Title": "按数量区间组合",
                    "PlanType": 2,
                    "PlanJson": "[{"Interval":{"S":1,"E":1},"GroupCard":[{"Denom":2.0,"Num":1,"CalcType":1,"CpkId":692},{"Denom":1.0,"Num":1,"CalcType":1,"CpkId":693}]}]", // 按数量区间组合 Json字符串数据结构 
                    "CardKindIds": ",692,693,",
                    "CreateTime": "2023-01-29 09:40:43",
                    "ModifyTime": "2023-01-29 11:50:49",
                    "ShowName": "按数量区间组合"
                }
            ],
            "TotalCount": 7,
            "PageNo": 1,
            "PageSize": 20
          },
            "Error_Code": 0,
            "Error_Msg": "",
            "AllowRetry": null,
            "RequestId": "20230108142251106"
          }
          
备注

发卡方案类型：0:组合卡、1:按数量组合、2:按数量区间组合、3:按地址组合、4:按留言组合、4:多组合顺序选一、5:多组合随机选一
PlanJson对象属性说明： CpkId：卡种Id； Denom：发货倍数； Num：实发数量； CalcType：数量计算方式，1：按发货倍数计算（Denom）2：按实发数量计算（Num）； Interval：数量区间， Interval.S：区间起始数量、Interval.E：区间结束数量； Pri：优先级；

获取发卡方案详情
简要描述：  接口调用示例

￥基础
获取发卡方案详情
请求URL：

https://gw-api.agiso.com/acpr/Sendcardplan/Get
请求方式：

POST
公共Header：

公共参数：

参数：

idNo
是
Long
发卡方案idNo
返回示例


          {
            "IsSuccess": true,
            "Data": {
              "IdNo": 187, 
              "Title": "按数量区间组合",
              "PlanType": 2, // 发卡方案类型 
              "PlanJson": "[{"Interval":{"S":1,"E":1},"GroupCard":[{"Denom":2.0,"Num":1,"CalcType":1,"CpkId":692},{"Denom":1.0,"Num":1,"CalcType":1,"CpkId":693}]}]", // 发卡方案Json字符串数据结构 
              "CardKindIds": ",692,693,", // 卡种Id 
              "CreateTime": "2023-01-29 09:40:43",
              "ModifyTime": "2023-01-29 11:50:49",
              "ShowName": "按数量区间组合"
          },
            "Error_Code": 0,
            "Error_Msg": "",
            "AllowRetry": null,
            "RequestId": "20230108142251106"
          }
          
备注

发卡方案类型：0:组合卡、1:按数量组合、2:按数量区间组合、3:按地址组合、4:按留言组合、4:多组合顺序选一、5:多组合随机选一


更新发卡方案
简要描述：  接口调用示例

￥基础
更新发卡方案
请求URL：

https://gw-api.agiso.com/acpr/SendCardPlan/Update
请求方式：

POST
公共Header：

公共参数：

参数：

IdNo
是
Long
发卡方案IdNo
PlanJson
是
String
JSON数据结构（根据PlanType类型）字符串，可参考发卡方案列表接口示例
Title
是
String
发卡方案名称
AliasName
否
String
别名
返回示例


          {
            "IsSuccess": true,
            "Error_Code": 0,
            "Error_Msg": "",
            "AllowRetry": null,
            "RequestId": "20230108142251106"
          }



发卡方案提卡
简要描述：  接口调用示例

￥高级
发卡方案提卡
请求URL：

https://gw-api.agiso.com/acpr/SendCardPlan/HandPick
请求方式：

POST
公共Header：

公共参数：

参数：

tid
是
String
订单号
buyer
否
String
买家名称
spId
是
Long
发卡方案idNo
num
是
Number
数量
payment
是
Decimal
金额
keyword
否
String
关键词，根据发卡方案类型（按地址组合、按留言组合）传值
返回示例


          {
            "IsSuccess": true,
            "Data": [
              {
                  "CardNoShowType": 0,  // 卡号展示类型 
                  "PwdShowType": 0,     // 卡密展示类型 
                  "PrefixCardNo": "卡号：", // 卡号前缀 
                  "PrefixPwd": "密码：",  // 卡密前缀 
                  "Title": "n1",  // 卡种名称 
                  "CpkId": 729,   // 卡种ID 
                  "CardPwdArr": [ // 卡号卡密数组 
                      {
                          "c": "【3】卡号：1000", // 卡号 
                          "p": ""                // 卡密 
                      },
                      {
                          "c": "【4】卡号：1000",
                          "p": ""
                      }
                  ]
              },
              {
                  "CardNoShowType": 0,
                  "PwdShowType": 0,
                  "PrefixCardNo": "卡号：",
                  "PrefixPwd": "密码：",
                  "Title": "n2",
                  "CpkId": 730,
                  "CardPwdArr": [
                      {
                          "c": "【6】卡号：2000",
                          "p": ""
                      },
                      {
                          "c": "【7】卡号：2000",
                          "p": ""
                      },
                      {
                          "c": "【8】卡号：2000",
                          "p": ""
                      },
                      {
                          "c": "【9】卡号：2000",
                          "p": ""
                      }
                  ]
              }
          ],
            "Error_Code": 0,
            "Error_Msg": "",
            "AllowRetry": null,
            "RequestId": "20230108142251106"
          }
          
备注

发卡方案类型：0:组合卡、1:按数量组合、2:按数量区间组合、3:按地址组合、4:按留言组合、4:多组合顺序选一、5:多组合随机选一


删除商家授权
简要描述：  接口调用示例

￥基础
开发者自行删除对商家的授权
请求URL：

https://gw-api.agiso.com/acpr/Sys/TokenDelete
请求方式：

POST
公共Header：

公共参数：

参数：

在公共Header处，上传相应Authorization参数，就能删除相应的商家
返回示例


  {
    "IsSuccess": false,
    "Error_Msg": "删除失败",
  }


卡密库存预警通知
简要描述：  推送示例

￥基础
提卡时触发库存校验，当库存数量小于等于预警数量时，推送预警消息（未再次添加卡密前，24小时内限推送一次）。
推送的签名请务必验证，以验证数据来源的合法性。验证方法参考以下说明。
推送时，有可能消息重复推送。在业务进行之前，对消息进行去重判断，以Tid组合为唯一标识。
推送方式，用jquery做示例：$.post('http://test.com/agiso?timestamp=11222212121&sign=f8aa165fc951f266667e0605d78b93af&aopic=32768', { json: '{"Tid":"592823138",......}' })
推送参数：

fromPlatform
string
Query/Get
平台，参数值：TbAcs,TbAlds,TbArs,Print,Acpr,PddAlds,AldsIdle,AldsJd,AldsDoudian,AldsKwai,AldsYouzan,AldsWeidian,AldsWxVideoShop,AldsXhs,Open
timestamp
Number
Query/Get
时间戳
aopic
Number
Query/Get
推送类型，1:卡密库存预警通知;
sign
String
Query/Get
签名算法：
   将json和timestamp参数名和参数值组合起来（注意：json在前，timestamp在后），然后前后添加上AppSecret ，再进行Md5加密（加密算法参考接入指南-完整调用API示例代码中MD5算法）。
例：
url：http://test.com/agiso?timestamp=11222212121&sign=f8aa165fc951f266667e0605d78b93af&aopic=256，
postData: { json: {"Tid":2067719225654838,"Status":"WAIT_BUYER_CONFIRM_GOODS",......,"TotalFee":"3.00"} }，
_appsecret: 9f8g9d78sg9d8f8ew9f89ds9f8ds9af8(开发者AppSecret)，
连接后的串: 9f8g9d78sg9d8f8ew9f89ds9f8ds9af8json{"Tid":2067719225654838,"Status":"WAIT_BUYER_CONFIRM_GOODS",......,"TotalFee":"3.00"}timestamp112222121219f8g9d78sg9d8f8ew9f89ds9f8ds9af8
再对连接后的字符串，进行MD5加密，
MD5结果: f8aa165fc951f266667e0605d78b93af（不区分大小写）
json
String
Form/Post
推送消息,如：
{
 "AliasName": "10充值卡别名",    // 卡种别名
 "CpkName": "10充值卡",   // 卡种名称
 "CpkId": 25,    // 卡种Id
 "WarningNum": 50,    // 库存预警值
 "RemainingCount": 45,    // 库存
 "CreateTime": "2022-01-19T10:36:39",    // 触发预警时间
}


错误代码

1
无效AccessToken
2
Api调用限制
3
业务异常
4
验签失败
5
参数错误
6
部分失败
7
全部失败
8
授权失败
9
交易不存在
10
淘宝Api请求错误
11
没有数据
12
已经发过旺旺消息
13
超时
14
生成旺旺消息失败
15
宝贝不存在
16
预存款余额不足了，限制接口调用
17
应用已被禁用
18
业务站点未授权
19
退款失败
20
单笔退款最大金额限制
21
退款总额限制
22
退款次数限制
23
闲鱼Api请求错误
24
更新订单状态失败
25
发送消息限制
26
拼多多API请求错误
27
京东API请求错误
28
无API接口权限
30
快手API请求错误
31
有赞API请求错误
32
微盟API请求错误
33
微店API请求错误
34
拒绝退款失败
35
微信小店API请求错误
114
没有数据
备注

无

收费规则
基础
0.002 0.001
按实际调用量计费
高级
0.004 0.002
按实际调用量计费
增值
0.008 0.004
按实际调用量计费


签名算法
Python
import hashlib
  from collections import OrderedDict
  
  def generate_sign(params, app_secret):
      # 1. 对参数键按字典序排序
      sorted_params = OrderedDict(sorted(params.items(), key=lambda x: x[0]))
  
      # 2. 拼接字符串：首尾加入 client_secret
      query_str = app_secret
      for key, value in sorted_params.items():
          query_str += f"{key}{value}"
      query_str += app_secret
  
      # 3. 计算 MD5 并转为小写十六进制
      md5 = hashlib.md5()
      md5.update(query_str.encode('utf-8'))
      sign = md5.hexdigest().lower()
      return sign
  
  # 示例使用
  if __name__ == "__main__":
      # 准备参数
      params = {
          "tids": "1234567789",
          "timestamp": "1468476350"  # 假设当前时间为 2016/7/14 14:5:50
      }
      app_secret = "******************"  # 替换为实际 AppSecret
  
      # 生成签名并添加到参数
      sign = generate_sign(params, app_secret)
      params["sign"] = sign

常见问题
提问：调用接口时提示验证签名失败？
回答：检查调用接口的机器的时间是否差别太大。接口参数排序的时候，不要忽略大小写。
提问：接收推送时sign与自己算出来的不一致，验证不通过？
回答：请留意，部份开发语言，在对接收到的json串进行url_decode时，无法自动把+号转化为空格。会导致签名计算不通过。比如：“Created":"2020-01-01+15:00:00"正确的url_decode结果应为：“Created":"2020-01-01 15:00:00"
提问：不同推送类型的aopic值是多少？
回答：1：买家拍下；2：买家付款；524288：卖家修改备注；2048：自动发货成功；1048576：卖家发货；4：买家确认收货；16：双方已评；256：退款创建；32768：退款关闭；65536：退款成功；131072：卖家同意退货；262144：卖家拒绝退货；2097152：买家付款（新版买家付款）


